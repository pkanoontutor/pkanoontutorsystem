{% extends "core/base.html" %}
{% load extras %}
{% block title %}Student Attendance (Details){% endblock %}

{% block head %}
<style>
  .stickyhead { position: sticky; top: 0; background: #fff; z-index: 2; }
  .status-pill {
    display:inline-block;
    padding:3px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:800;
    margin-left:6px;
  }
  .s-present { background:#dcfce7; border:1px solid #22c55e; color:#166534; }
  .s-excused { background:#fef9c3; border:1px solid #eab308; color:#854d0e; }
  .s-no_show { background:#fee2e2; border:1px solid #ef4444; color:#991b1b; }
  .cell { white-space:nowrap; font-size:13px; }
  .table-wrap { overflow:auto; }
</style>
{% endblock %}

{% block content %}
<div class="topbar">
  <div class="card" style="flex:1; min-width:280px;">
    <div style="font-weight:900; font-size:18px;">Student Attendance (Details)</div>
    <div class="muted">
      Row = ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô | Column = ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà | ‡∏ä‡πà‡∏≠‡∏á = ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏°‡∏≤/‡∏•‡∏≤/‡∏Ç‡∏≤‡∏î)
    </div>
  </div>

  <div class="card">
    <a class="btn" href="/dashboard/">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard</a>
  </div>
</div>

{% for cls in classes %}
  <div class="card" style="margin-bottom:14px;">
    <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
      <div style="font-weight:900; font-size:16px;">{{ cls.name }}</div>
      <div class="muted">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>
    </div>

    <div class="table-wrap" style="margin-top:10px;">
      <table>
        <thead class="stickyhead">
          <tr>
            <th style="min-width:260px;">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>

            {% with cols=col_numbers_by_class|get_item:cls.id %}
              {% if cols %}
                {% for n in cols %}
                  <th style="min-width:140px;">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà {{ n }}</th>
                {% endfor %}
              {% else %}
                <th>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th>
              {% endif %}
            {% endwith %}
          </tr>
        </thead>

        <tbody>
          {% with rows=grouped_rows|get_item:cls.id %}
            {% if rows %}
              {% for row in rows %}
                <tr>
                  <td>
                    <b>{{ row.enrollment.student.display_name }}</b>
                    <div class="muted">{{ row.enrollment.get_enrollment_type_display }}</div>
                  </td>

                  {% with cols=col_numbers_by_class|get_item:cls.id %}
                    {% for n in cols %}
                      {% with idx=n|add:"-1" %}
                        {% with rec=row.records|index:idx %}
                          <td class="cell">
                            {% if rec %}
                              {{ rec|get_item:"date"|date:"Y-m-d" }}

                              {% if rec|get_item:"status" == "present" %}
                                <span class="status-pill s-present">‡∏°‡∏≤</span>
                              {% elif rec|get_item:"status" == "excused" %}
                                <span class="status-pill s-excused">‡∏•‡∏≤</span>
                              {% else %}
                                <span class="status-pill s-no_show">‡∏Ç‡∏≤‡∏î</span>
                              {% endif %}
                            {% else %}
                              -
                            {% endif %}
                          </td>
                        {% endwith %}
                      {% endwith %}
                    {% endfor %}
                  {% endwith %}
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="50" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</td>
              </tr>
            {% endif %}
          {% endwith %}
        </tbody>
      </table>
    </div>

    <div class="muted" style="margin-top:8px;">
      üü¢ ‡∏°‡∏≤ | üü° ‡∏•‡∏≤ | üî¥ ‡∏Ç‡∏≤‡∏î
    </div>
  </div>
{% endfor %}
{% endblock %}
